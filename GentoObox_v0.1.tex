\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{amsmath, amsfonts, amssymb, graphicx, braket, multicol, enumitem, pdfpages, fancyhdr, hyperref, xcolor, listings}
\usepackage[export]{adjustbox}
\usepackage[width=17.00cm, height=24.00cm]{geometry}

\lstdefinestyle{BashInputRoot}{
    backgroundcolor=\color{black},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
    basicstyle=\ttfamily\color{white},        % the size of the fonts that are used for the code
%   breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
%   breaklines=false,                 % sets automatic line breaking
%   captionpos=b,                    % sets the caption-position to bottom
%   commentstyle=\color{mygreen},    % comment style
%   deletekeywords={chroot},            % if you want to delete keywords from the given language
%   escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
%   extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
%   frame=single,                      % adds a frame around the code
%   keepspaces=false,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
%   keywordstyle=\color{white},       % keyword style
    language=Bash,                 % the language of the code
%   morekeywords={},           % if you want to add more keywords to the set
%   alsoletter= {root \# },
    literate={root\#}{{\textcolor{red}{root \#}}}7,
%   numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
%   numbersep=5pt,                   % how far the line-numbers are from the code
%   numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
%   rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
%   showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
%   showstringspaces=false,          % underline spaces within strings only
%   showtabs=false,                  % show tabs within strings adding particular underscores
%   stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
%   stringstyle=\color{mymauve},     % string literal style
%   tabsize=2,                     % sets default tabsize to 2 spaces
%   title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
    linewidth=\linewidth,
    breaklines=true
}

\lstdefinestyle{BashInputCHRoot}{
    backgroundcolor=\color{black},
    basicstyle=\ttfamily\color{white},
    language=Bash,
    literate={CHroot\#}{{\textcolor{red}{CHroot \#}}}7,
    linewidth=\linewidth,
    breaklines=true
}

\lstdefinestyle{BashInputUser}{
    backgroundcolor=\color{black},
    basicstyle=\ttfamily\color{white},
    language=Bash,
    literate={user\$}{{\textcolor{green}{user \$}}}7,
    linewidth=\linewidth,
    breaklines=true
}

\lstdefinestyle{KernelConfig}{
    backgroundcolor=\color{lightgray},
    basicstyle=\ttfamily\color{black},
    linewidth=\linewidth,
    breaklines=true
}

\definecolor{eclipseBlue}{RGB}{42,0.0,255}
\lstdefinelanguage{LinuxConfigFiles}{
    backgroundcolor=\color{yellow!30},
    basicstyle=\ttfamily,
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{black!50},
    title=\lstname,
    linewidth=\linewidth,
    breaklines=true,
    commentstyle=\color{eclipseBlue},
    morecomment=[l]{\#}
}

\title{
    GentoObox \\
    \large simple manual for minimalistic Gentoo installation with Openbox environment
}

\begin{document}
    \pagestyle{fancy}

    \maketitle
    \newpage

    \tableofcontents

    \newpage
    \section{Introduction}

        \paragraph{} Thanks to my father, I am an Gentoo user since high school. Although 10 years have passed from my first installation, there is little difference with my last. I always go to the Gentoo handbook, always google additional information, always have new ideas to achieve, and always spend a week or two configuring the system to suit my needs. I cannot say that my needs are so special - I need a browser, video player, unified look and feel in the GUI, little programming tools. I like when things work as smooth and fast as possible, and of course as reliable as possible.

        \paragraph{} My initial choice of environment was Gnome2, but after the changes introduced in Gnome3 I was on a crossroad. I never liked how KDE looks and feels, so the next logical choice was Xfce. It truly was fast and easy to use, but somehow did not feel right and my search continued. Governed by the idea that everything should be as fast and light as possible I started experimenting with windows managers. From all of the ones out there Openbox got my heart.

        \paragraph{} Of course choosing to use window manager has its benefits and drawbacks. The pros are small dependencies, lightweight, fast, reliability, freedom to choose what you want to use. The cons are how much work and effort you have to put into building your system, but isn't this the Gentoo way after all?

        \paragraph{} Unfortunately there are not many guides how to build your system. Some honourable mentions are \href{https://urukrama.wordpress.com/openbox-guide/}{Urukrama openbox guide}, \href{https://wiki.gentoo.org/wiki/Openbox}{Gentoo Openbox Wiki}, \href{https://wiki.archlinux.org/index.php/openbox}{Arch Openbox Wiki}, but they do not contain all the answers. For example it took me embarrassingly long time to understand what is a dock, example plank, system tray and how they do not mix in all cases. Or how to create dual head configuration using ZaphodHeads method in xorg. This document is dedicated to all of those problems I faced and put numerous hours to resolve.

    \newpage
    \section{Basic Gentoo installation}

        \subsection{Preparing the disks}

            \paragraph{} This section is dedicated on the basic Gentoo installation. It follows for the most part \href{https://wiki.gentoo.org/wiki/Handbook:AMD64}{Gentoo AMD64 Handbook} and will include additional details.

            \paragraph{} I usually use some live distro for the installation and initial configuration, and thus presume this position for the rest of the text. Without further ado the first step, of course is \href{https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Disks}{preparing the disk}. For the moment I have not met any need for GPT or UEFI and continue using MRB with BIOS. Almost all of the live distros I have encountered include \textit{Gparted}, so I use it for the partitionin.

            \newpage
            \subsubsection{ MBR with BIOS }

                \paragraph{} Using \textit{Gparted}
                
                \begin{enumerate}
                    \item you have chosen the correct device, \textit{/dev/sdb}\footnote{ I am presuming we are working from live usb distro, so usually \textbf{/dev/sda} is the usb drive, and \textbf{/dev/sdb} is the disk we are working on.}
                    \item go to \textit{Device -> Create Partition table} and make sure it is \textbf{MBR}
                \end{enumerate}

                \paragraph{} For all of my purposes I need no more than $ 150 \mbox{ GB}$ so sufficient configuration for me is something like: 
                
                \begin{itemize}
                    \item \textbf{swap} - swap - as much as the physical RAM on the machine
                    \item \textbf{boot partition} - ext4 - $ 512 \mbox{ MB} $  - boot partition, for historical reasons and \href{https://superuser.com/questions/522971/is-a-boot-partition-always-necessary}{structural benefits}, I have found article which discusses the differences between /boot, bootloader partition in greater detail, but at the time of writing I did not manage to find it again
                    \item \textbf{root partition} - ext4 - $ 60 \mbox{ GB} $ - the partition for root /
                    \item \textbf{home partition} - ext4 - $ 120 \mbox{ GB} $ - the partition for /home, reasons see above link
                \end{itemize}

                \paragraph{} After the partitioning is done the live distro usually automaticly activates the swap, but if necessary you can do it by hand with.

                \begin{lstlisting}[style=BashInputRoot]
root# swapon /dev/sdb{swap partition number}
                \end{lstlisting}

        \newpage
        \subsection{Installing a stage tarball}
            \paragraph{} Now lets mount the root partition.

            \begin{lstlisting}[style=BashInputRoot]
root# mkdir /mnt/gentoo && \
      mount /dev/sdb{root partition number} /mnt/gentoo
            \end{lstlisting}

            \paragraph{} Make sure the date is correct

            \begin{lstlisting}[style=BashInputRoot]
root# date
 Sun Sep 24 10:58:24 EEST 2017
            \end{lstlisting}

            \paragraph{} If it is not, set it using the format \textit{MMDDhhmmYYYY}, so to set it as the above

            \begin{lstlisting}[style=BashInputRoot]
root# date 092410582017 && date
 Sun Sep 24 10:58:24 EEST 2017
            \end{lstlisting}

            \paragraph{} Navigate to \href{https://www.gentoo.org/downloads/}{Gentoo download section} and choose \textbf{Stage 3} for your architecture, mine is \textit{amd64}, and place the tarball in \textbf{/mnt/gentoo}, and unpack it

            \begin{lstlisting}[style=BashInputRoot]
root# cd /mnt/gentoo && \
 curl -O http://distfiles.gentoo.org/releases/amd64/{path to file} && \
 tar xvjpf stage3-*.tar.bz2 --xattrs --numeric-owner
            \end{lstlisting}

        \newpage
        \subsection{Initial Gentoo configuring}

            \subsubsection{Pre requires}

                \paragraph{} Now we will \textbf{chroot} into \textit{/mnt/gentoo} and configure everything within there. For this to happen we need to
                \begin{enumerate}
                    \item copy dns info
                    \item mount our partitions
                    \item mount the necessary filesystems
                \end{enumerate}

                \begin{enumerate}

                    \newpage
                    \item to ensure that networking still works even after entering the new environment. This is done by

                    \begin{lstlisting}[style=BashInputRoot]
root# cp -L /etc/resolv.conf /mnt/gentoo/etc/
                    \end{lstlisting}

                    \newpage
                    \item mount our partitions

                    \paragraph{} Firstly lets mount them

                    \begin{lstlisting}[style=BashInputRoot]
root# mount /dev/sdb{boot partition number} /mnt/gentoo/boot
root# mount /dev/sdb{home partition number} /mnt/gentoo/home
                    \end{lstlisting}

                    \paragraph{} Lets add them to \textbf{/etc/fstab}, which should look something like this

                    \lstinputlisting[linerange={30-34}, firstnumber=30, language=LinuxConfigFiles]{sample_configs/fstab_example}

                    \paragraph{} Quick reference by field, for more details \href{http://www.coolcoder.in/2013/12/linux-fstab-file-explained.html}{for example see here} or \href{https://wiki.archlinux.org/index.php/fstab}{here}
                    \begin{enumerate}[label=(\arabic*)]
                        \item device/partition, can be specified with label, network id, device path
                        \item mount point
                        \item filesystem type
                        \item mount options, some of the used are: \begin{itemize}
                            \item defaults: Uses the default options that are rw, suid, dev, exec, auto, nouser, and async
                            \item noatime: fully disables writing file access times to the drive every time you read a file. This works well for almost all applications, except for those that need to know if a file has been read since the last time it was modified.
                            \item auto: noauto
                        \end{itemize}
                        \item dump field: single digit, sets whether the backup utility dump will backup filesystem, set to $ 0 $ to ignore or $ 1 $ to back up
                        \item pass field: single digit, \textbf{fsck} order to check the filesystem at boot \begin{itemize}
                            \item $ 0 $ means do not check recommended for network shares
                            \item $ 1 $ check this partition first, highly recommended \underline{only for root partition}
                            \item $ 2 $ check this partition next, all partitions marked with it are checked in sequence and we do not need to specify an order
                        \end{itemize}
                    \end{enumerate}

                    \newpage
                    \item mount the necessary filesystems, again I presume using non-Gentoo installation media
                    \begin{lstlisting}[style=BashInputRoot]
 root# mount -t proc /proc /mnt/gentoo/proc
 root# mount --rbind /sys /mnt/gentoo/sys
 root# mount --make-rslave /mnt/gentoo/sys
 root# mount --rbind /dev /mnt/gentoo/dev
 root# mount --make-rslave /mnt/gentoo/dev
 root# test -L /dev/shm && rm /dev/shm && mkdir /dev/shm
 root# mount -t tmpfs -o nosuid,nodev,noexec shm /dev/shm
 root# chmod 1777 /dev/shm
                    \end{lstlisting}

                \end{enumerate}

            \newpage
            \subsubsection{Chroot at /mnt/gentoo}

                \paragraph{} We need to enter the new installation environment by chrooting into it:

                \begin{lstlisting}[style=BashInputRoot]
root# chroot /mnt/gentoo /bin/bash
root# source /etc/profile
root# export PS1="CH${PS1}"
                \end{lstlisting}

                \paragraph{} Which should result into following line, thus we will recognize if we are at the live medium or into the changed root of Gentoo.

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot#
                \end{lstlisting}

        \newpage
        \subsection{Configure portage}

            \subsubsection{Repository}

                \paragraph{} First we need to configure the repository, if it does not exist.

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# mkdir -p /etc/portage/repos.conf
 CHroot# touch /etc/portage/repos.conf/gentoo.conf && nano /etc/portage/repos.conf/gentoo.conf
                \end{lstlisting}

                \paragraph{} It should look like this:

                \lstinputlisting[language=LinuxConfigFiles]{sample_configs/gentoo.conf_example}

                \paragraph{} Now lets fetch the latest snapshot, up to the last hour. The command might complain about some missing locations, but it is safe to ignore.

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge-webrsync && emerge --sync
                \end{lstlisting}

           \newpage
            \subsubsection{Profile selection}

                \paragraph{} Now lets choose our profile, each one comes with predefined use flags \href{https://wiki.gentoo.org/wiki/Handbook:PPC/Working/USE}{(if you are not sure come here)}

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# eselect profile list
 Available profile symlink targets:
 [1]   default/linux/amd64/13.0
 [2]   default/linux/amd64/13.0/selinux
 [3]   default/linux/amd64/13.0/desktop
 [4]   default/linux/amd64/13.0/desktop/gnome
 [5]   default/linux/amd64/13.0/desktop/gnome/systemd
 [6]   default/linux/amd64/13.0/desktop/plasma
 [7]   default/linux/amd64/13.0/desktop/plasma/systemd
 [8]   default/linux/amd64/13.0/developer
 [9]   default/linux/amd64/13.0/no-multilib
 [10]  default/linux/amd64/13.0/systemd
 [11]  default/linux/amd64/13.0/x32
 [12]  hardened/linux/amd64
 [13]  hardened/linux/amd64/selinux
 [14]  hardened/linux/amd64/no-multilib
 [15]  hardened/linux/amd64/no-multilib/selinux
 [16]  hardened/linux/amd64/x32
 [17]  hardened/linux/musl/amd64
 [18]  hardened/linux/musl/amd64/x32
 [19]  default/linux/uclibc/amd64
                \end{lstlisting}

                \paragraph{} For my purposes I need \textit{default/linux/amd64/13.0/desktop}

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# eselect profile set 3
                \end{lstlisting}

            \newpage
            \subsubsection{/etc/portage/make.conf}

                \paragraph{} The \textbf{/etc/portage/make.conf} is used to define settings and options applied to every package that is emerged. In the following lines I will explain in detail my configs. \href{https://wiki.gentoo.org/wiki//etc/portage/make.conf}{More details click here}

                \begin{itemize}
                    \item \textbf{CFLAGS}, \textbf{CXXFLAGS} are variables who define the build and compile flags that will be used for all package deployments. CFLAGS are for C based applications, CXXFLAGS are for C++ based ones.

                        \lstinputlisting[linerange={6-7}, firstnumber=6, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \begin{itemize}[label={o}]

                            \item \textbf{-march=native} option: If the type of CPU is undetermined, or if the user does not know what setting to choose, it is possible use the \textit{-march=native} settings. When this flag is used, GCC will attempt to detect the processor and automatically set appropriate flags for it. \textit{This should not be used when intending to compile packages for different CPUs!}\\ You can find the kind of CPU you have by using

                                \begin{lstlisting}[style=BashInputUser]
user$ cat /proc/cpuinfo
                                \end{lstlisting}

                                If you are interested in what flags a specific option, lets say \textbf{core2}, will activate check by

                                \begin{lstlisting}[style=BashInputUser]
user$ gcc -c -Q -march=core2 --help=target
                                \end{lstlisting}

                                If you are interested how the flags of different options will differ check with:

                                \begin{lstlisting}[style=BashInputUser]
user$ diff \
    <(gcc -march=native -Q --help=target) \
    <(gcc -march=core2 -Q --help=target)
                                \end{lstlisting}

                            \item \textbf{-O2} option: This variable controls the overall level of optimization. $ \mbox{-O}0 $ will turn it off, $ \mbox{-O}1 $ will do most basic. $ \mbox{-O}2 $ is a step up from $ \mbox{-O}1 $ and the recommended level. $ \mbox{-O}3 $ is the highest level, but does not guarantee to improve performance and in some cases can slow down system due to large binaries and increased memory usage.

                            \item \textbf{-pipe} option: Is a common flag which makes compilation process much faster.

                        \end{itemize}

                    \item \textbf{CHOST} variable is passed through the configure step of ebuilds to set the build-host of the system. Note that the Gentoo profile already sets the appropriate CHOST value, and updating it requires insight and experience in build chains.

                        \lstinputlisting[linerange={12-12}, firstnumber=12, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{ACCEPT\_KEYWORDS} defines globally, for all packages, on one hand the architecture, in our case it is \textbf{amd64}, since we have x86\_64, but it could have been \textbf{arm}; and if we are to use stable or unstable \textbf{$ \sim $} packages. In our case we want only stable packages for x86\_64. \href{https://wiki.gentoo.org/wiki/ACCEPT_KEYWORDS}{more detail on accept\_keywords}

                        \lstinputlisting[linerange={17-17}, firstnumber=17, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{MAKEOPTS} specify arguments passed to \textit{make} when packages are built from source. \href{https://wiki.gentoo.org/wiki/MAKEOPTS}{More info here}
                    \footnote{ \label{jobs-load-ref1} \href{https://lists.gt.net/gentoo/user/269934}{more detail on load average link1}}
                    \footnote{\label{jobs-load-ref2} \href{http://blog.scoutapp.com/articles/2009/07/31/understanding-load-averages}{more detail on load average link2}}
                    \footnote{\label{jobs-load-ref3} \href{https://blogs.gentoo.org/ago/2013/01/14/makeopts-jcore-1-is-not-the-best-optimization/}{more detail on load average link3}}
                    \footnote{\label{jobs-load-ref4} \href{https://www.preney.ca/paul/archives/341}{more detail on load average link4}}

                        \lstinputlisting[linerange={19-19}, firstnumber=19, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \begin{itemize}[label={o}]

                            \item \textbf{--jobs=4} defines how many parallel sessions to trigger, if they are possible. The recommended value is the number of logical processors in the CPU. You can obtain that number with the following command

                                \begin{lstlisting}[style=BashInputUser]
user$ nproc --all
                                \end{lstlisting}

                            \item \textbf{--load-average=3.8} option: This option prevents starting new installations if the load-average is more than $ 3.8 $. It is recommend your load-average to be as much as the number of logical CPU.

                        \end{itemize}

                    \item \textbf{EMERGE\_DEFAULT\_OPTS} specify arguments passed to \textit{emerge}. \href{https://wiki.gentoo.org/wiki/EMERGE_DEFAULT_OPTS}{More info here} See previous footnotes for details on load average and parallelism.
                    \footnote{ See footnote \ref{jobs-load-ref1}}
                    \footnote{ See footnote \ref{jobs-load-ref2}}
                    \footnote{ See footnote \ref{jobs-load-ref3}}
                    \footnote{ See footnote \ref{jobs-load-ref4}}

                        \lstinputlisting[linerange={20-20}, firstnumber=20, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \begin{itemize}[label={o}]
                            
                            \item \textbf{--jobs=4} sets the amount of parallel packages to emerge. Note that if you have set \textbf{makeopts -j N} and \textbf{emerge\_default\_opts -j K} you will end up with $ N*K $ tasks! The recommended value is the number of logical processors in the CPU.

                            \item \textbf{--load-average=3.8} prevents starting new instance of emerge if the load-average is more than $ 3.8 $. Rule of thumb is set it as much as the number of logical CPU.

                            \item \textbf{--with-bdeps y} option: By default, the dependency graph may not include some packages. If you would like to include such build time dependencies even though they are not strictly required. \href{https://wiki.gentoo.org/wiki/Project:Portage/FAQ\#Why_is_it_that_emerge_does_not_update_all_packages.3F}{more detail on emerge\_default\_opts with-bdeps option}

                            \item \textbf{--quiet-build y} option: Redirect all build output to logs alone, and do not display it on stdout. If a build failure occurs for a single package, the build log will be automatically displayed on stdout (unless the --quiet-fail option is enabled)

                            \item \textbf{--keep-going} option: Continue as much as possible after an error. When an error occurs, dependencies are recalculated for remaining packages and any with unsatisfied dependencies are automatically dropped.

                            \item \textbf{--autounmask-write y} option: If --autounmask is enabled, changes are written to config files, respecting CONFIG\_PROTECT and --ask. If the corresponding package.* is a file, the changes are appended to it, if it is a directory, changes are written to the lexicographically last file.

                        \end{itemize}

                    \item \textbf{FEATURES} variable specifies options which affect how Portage operates and how packages are compiled. It has some predefined options, depending on what profile has been set, but this is an incremental variable, thus values can be added without directly overriding the default ones. \href{https://dev.gentoo.org/~zmedico/portage/doc/man/make.conf.5.html}{Man page of emerge all \textit{Feature} variables with explanation}

                        \lstinputlisting[linerange={22-22}, firstnumber=22, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \begin{itemize}[label={o}]
                            
                            \item \textbf{parallel-install} option: Use finer-grained locks when installing packages, allowing for greater parallelization. For additional parallelization.

                            \item \textbf{multilib-strict} option: Many Makefiles assume that their libraries should go to /usr/lib, or \$(prefix)/lib. This assumption can cause a serious mess if /usr/lib isn't a symlink to /usr/lib64. To find the bad packages, we have a portage feature called multilib-strict. It will prevent emerge from putting 64bit libraries into anything other than (/usr)/lib64.

                            \item \textbf{candy} Enable a special progress indicator when emerge calculates dependencies.

                        \end{itemize}

                    \item \textbf{AUTOCLEAN} enables portage to automatically clean out older or overlapping packages from the system after every successful merge. This is the same as running 'emerge -c' after every merge. Set with: "yes" or "no", recommended "yes" since can cause serious problems due overlapping packages.

                        \lstinputlisting[linerange={23-23}, firstnumber=23, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{CPU\_FLAGS\_X86} enables specific instructions for the architecture/cpu. \href{https://wiki.gentoo.org/wiki/CPU_FLAGS_X86}{More info}

                        \lstinputlisting[linerange={24-24}, firstnumber=24, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \paragraph{} The easiest way to obtain the flags is by using \textit{cpuinfo2cpuflags-x86}

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -v app-portage/cpuid2cpuflags && \
     cpuinfo2cpuflags-x86 >> /etc/portage/make.conf
                        \end{lstlisting}

                    \item \textbf{PYTHON\_TARGETS} controls support for various Python implementations in packages. \href{https://wiki.gentoo.org/wiki/Project:Python/PYTHON_TARGETS}{More info}

                        \lstinputlisting[linerange={25-25}, firstnumber=25, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{VIDEO\_CARDS} sets the video drivers that you intend to use. Will talk about kernel configs later on. \href{https://wiki.gentoo.org/wiki/Xorg/Guide#make.conf}{More info}

                        \lstinputlisting[linerange={27-27}, firstnumber=27, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{INTEL\_MODESETTING} sets the usage of GLAMOR to accelerate 2D graphical over Mesa. It is intel specific thing, since \textit{Intel DDX driver} has been slowly deprecating, it is recommend to use \textit{modesetting DDX driver}. \href{https://wiki.gentoo.org/wiki/Intel#Modesetting_DDX}{More info}

                        \lstinputlisting[linerange={28-28}, firstnumber=28, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{INPUT\_DEVICES} sets drivers for input devices. Kernel configs are later. \href{https://wiki.gentoo.org/wiki/Evdev#Driver}{evdev is responsible for keyboards, mice, joysticks, etc...}. \href{https://wiki.gentoo.org/wiki/Synaptics#Driver}{synaptics is responsible for touchpads}

                        \lstinputlisting[linerange={30-30}, firstnumber=30, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{L10N, LINGUAS} are localization variables. \textit{L10N} will replace the \textit{LINGUAS} in future, but for compatibility reasons should set them both for the moment. \href{https://wiki.gentoo.org/wiki/Localization/Guide#LINGUAS}{More info for LINGUAS} and \href{https://wiki.gentoo.org/wiki/Localization/Guide#L10N}{More info for L10N} and \href{https://www.gentoo.org/support/news-items/2016-06-23-l10n-use_expand.html}{More info about the replacement}

                        \lstinputlisting[linerange={32-33}, firstnumber=32, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{SOUND} variable is to define use-flags related to sound. Its only entry is the necessary use flag for \href{https://wiki.gentoo.org/wiki/PulseAudio#Software}{\textit{PulseAudio} - sound server that provides a number of features on top of ALSA(most importantly - youtube with sound)} Kernel configs are for further.

                        \lstinputlisting[linerange={35-35}, firstnumber=35, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{NETWORK} variable is to define use-flags related to network. Its only entry is the necessary use flag for \href{https://wiki.gentoo.org/wiki/NetworkManager#Installation}{NetworkManager}. More on kernel config later on.

                        \lstinputlisting[linerange={36-36}, firstnumber=36, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{FONTS} variable is to define use-flags related to fonts config. \href{http://kev009.com/wp/2009/12/getting-beautiful-fonts-in-gentoo-linux/}{they are recommended from here}, although I am not following the full article any more. More info later on.

                        \lstinputlisting[linerange={37-37}, firstnumber=37, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{GUI} variable to define use-flags related to GUI - such as gtk, qt and similar. In general I prefer qt over gtk, but above all I want all of them to look alike. Since my last installation I noticed that including both \textit{qt4} and \textit{qt5} I could not achieve that, but more details later.

                        \lstinputlisting[linerange={38-38}, firstnumber=38, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{MISC} misc use flags

                        \lstinputlisting[linerange={39-39}, firstnumber=39, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{USE} use variable is the keyword, which use flags. Since it permits the usage of variables I did so and the final result is

                        \lstinputlisting[linerange={41-41}, firstnumber=41, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                    \item \textbf{GENTOO\_MIRRORS} is setting the mirrors.

                        \lstinputlisting[linerange={50-50}, firstnumber=50, language=LinuxConfigFiles]{sample_configs/make.conf_example}

                        \paragraph{} Let \textit{mirrorselect} to do the job for you with the following command:

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -v mirrorselect && \
     mirrorselect --servers 5
                        \end{lstlisting}

                \end{itemize}

            \newpage
            \subsubsection{Configure timezone and locales}

                \begin{enumerate}
                    \item  \href{https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base#Timezone}{Timezone}

                        \paragraph{} Available timezones are placed into \textit{/usr/share/zoneinfo/}, and you need to write them in the \textit{/etc/timezone} file and then you should reconfigure  sys-libs/timezone-data Lets say your capital is Sofia, so

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# echo $(find /usr/share/zoneinfo/ -name "Sofia" \
         | cut -d"/" -f5-) \
         > /etc/timezone \
         && emerge -v sys-libs/timezone-data \
         && emerge --config sys-libs/timezone-data
                        \end{lstlisting}

                    \newpage
                    \item   \href{https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base#Configure_locales}{Locals}

                        \paragraph{} specify not only the language, but also what the rules are for sorting strings, displaying dates and times etc. Available combinations of locale are placed at \textit{/usr/share/i18n/SUPPORTED}, for my case I want to see combinations of \textit{bg}, so

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# cat /usr/share/i18n/SUPPORTED | grep bg
 bg_BG.UTF-8 UTF-8
 bg_BG CP1251
                        \end{lstlisting}

                        \paragraph{} Now to specify wanted locals we shall edit \textit{/etc/locale.gen}. Add the ones we want, if missing, or comment/uncomment depending on our needs.

                        \lstinputlisting[linerange={16-18,23-28}, firstnumber=16, language=LinuxConfigFiles]{sample_configs/locale.gen_example}

                        \paragraph{} Last step is to generate the locals with

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# locale-gen
                        \end{lstlisting}

                        \paragraph{} Finally lets set the system-wide locale. In near future will set link to a nice article about all those variables and why I chose \textit{C}

                        \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# eselect locale list
 Available targets for the LANG variable:
 [1]   C
 [2]   POSIX
 [3]   bg_BG
 [4]   bg_BG.cp1251
 [5]   bg_BG.utf8
 [6]   en_US
 [7]   en_US.iso88591
 [8]   en_US.utf8
 CHroot# eselect locale set 1
                        \end{lstlisting}

                \end{enumerate}

        \newpage
        \subsection{Kernel configuration}

            \paragraph{} Despite the method you choose run

            \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va sys-kernel/gentoo-sources sys-kernel/linux-firmware
            \end{lstlisting}

            \newpage
            \subsubsection{Easy way - genkernel}

                \paragraph{} Alternative to manual configuration is using genkernel\href{https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Alternative:_Using_genkernel}{,click the here for more info.}

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va sys-kernel/genkernel && genkernel all
                \end{lstlisting}

                \paragraph{} This process should take a while and you are done with your kernel config.

            \newpage
            \subsubsection{Hard way - manual configuration}

                \paragraph{} Important note: I will not use modules since \href{https://wiki.gentoo.org/wiki/Kernel/Gentoo_Kernel_Configuration_Guide#Modules_do_not_get_loaded_automatically}{they make life harder.}

                \paragraph{} For my case important source of info was \href{https://wiki.gentoo.org/wiki/Lenovo_ThinkPad_T440s}{this gentoo guide}

                \paragraph{} Manual configuration is much easier with \textit{lspci} which is included into \textit{pciutils}. This command will identify PCI-based and AGP-based hardware and help us to find the driver into the kernel.

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va sys-apps/pciutils sys-apps/usbutils
                \end{lstlisting}

                \paragraph{} Our first step is to see our hardware and drivers in use. Remember that I presume we are installing Gentoo using an live medium, thus I presume that most or even all the hardware is working. This means that the live usb has successfully recognized and loaded the modules we need to compile. To see which modules are in use and for which device we simply

                \begin{lstlisting}[style=BashInputRoot]
 root# lspci -k 
 00:00.0 Host bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor DRAM Controller (rev 06)
 Subsystem: Lenovo Xeon E3-1200 v3/4th Gen Core Processor DRAM Controller
 00:02.0 VGA compatible controller: Intel Corporation 4th Gen Core Processor Integrated Graphics Controller (rev 06)
 Subsystem: Lenovo 4th Gen Core Processor Integrated Graphics Controller
 Kernel driver in use: i915
 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06)
 Subsystem: Lenovo Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller
 Kernel driver in use: snd_hda_intel
 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family USB xHCI
 Kernel driver in use: xhci_hcd
 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family MEI Controller
 Kernel driver in use: mei_me
 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family USB EHCI
 Kernel driver in use: ehci-pci
 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset High Definition Audio Controller
 Kernel driver in use: snd_hda_intel
 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4)
 Kernel driver in use: pcieport
 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d4)
 Kernel driver in use: pcieport
 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4)
 Kernel driver in use: pcieport
 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d4)
 Kernel driver in use: pcieport
 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family USB EHCI
 Kernel driver in use: ehci-pci
 00:1f.0 ISA bridge: Intel Corporation HM87 Express LPC Controller (rev 04)
 Subsystem: Lenovo HM87 Express LPC Controller
 Kernel driver in use: lpc_ich
 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode]
 Kernel driver in use: ahci
 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 04)
 Subsystem: Lenovo 8 Series/C220 Series Chipset Family SMBus Controller
 Kernel driver in use: i801_smbus
 02:00.0 Unassigned class [ff00]: Realtek Semiconductor Co., Ltd. RTS5227 PCI Express Card Reader (rev 01)
 Subsystem: Lenovo RTS5227 PCI Express Card Reader
 Kernel driver in use: rtsx_pci
 03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 10)
 Subsystem: Lenovo RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller
 Kernel driver in use: r8169
 04:00.0 Network controller: Intel Corporation Wireless 7260 (rev 73)
 Subsystem: Intel Corporation Wireless-N 7260
 Kernel driver in use: iwlwifi
 root# lsusb
 Bus 002 Device 002: ID 8087:8000 Intel Corp.
 Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
 Bus 001 Device 002: ID 8087:8008 Intel Corp.
 Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
 Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
 Bus 003 Device 003: ID 8087:07dc Intel Corp.
 Bus 003 Device 002: ID 17ef:604d Lenovo
 Bus 003 Device 005: ID 0bda:5719 Realtek Semiconductor Corp.
 Bus 003 Device 004: ID 138a:0011 Validity Sensors, Inc. VFS5011 Fingerprint Reader
 Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
                \end{lstlisting}

                \paragraph{} So lets make a list
                \begin{enumerate}
                    \item VGA compatible controller (video card) uses kernel module \textbf{i915}
                    \item Audio device, integrated HD Audio controller uses kernel module \textbf{snd\_hda\_intel}
                    \item USB controller: uses kernel modules\textbf{xhci\_pci}
                    \item PCI bridge: \textbf{pcieport}
                    \item isa bridge: \textbf{lpc\_ich}
                    \item sata controller: \textbf{ahci}
                    \item smbus: \textbf{i2c\_i801}
                    \item ethernet controller: \textbf{r8169}
                    \item network controller (wifi): \textbf{iwlwifi}
                    \item pcie card reader: \textbf{rtsx\_pci} \href{https://wiki.gentoo.org/wiki/Lenovo_ThinkPad_T440s#Hardware_Status}{some info here}
                    \item Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller \#1: \textbf{mei\_me}
                \end{enumerate}

                \paragraph{} Now lets go to the kernel menu

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# cd /usr/src/linux && make menuconfig
                \end{lstlisting}

                \paragraph{} If we want to search for any module/driver/config, we simply press \textbf{/} and type what we are searching. For example when we search for \textbf{i915}, we get something like

                \begin{lstlisting}[style=KernelConfig]
 Symbol: DRM_I915 [=y]
 Type: tristate
 Prompt: Intel8xx/9xx/G3x/G4x/HD Graphics
 Location:
     -> Device Drivers
         -> Graphics Support
 Defined at drivers/gpu/drm/i915/Kconfig:1
 Dpends on: HAS_IOMEM [=y] && DRM [=y] && X86 [=y] && PCI [=y]
 Slectts: INTEL_GTT [=y] && INTERVAL_TREE [=y] && SHMEM [=y] && TMPFS [=y] ...
                \end{lstlisting}

                \paragraph{} This tells us we can find the current driver under Device Drivers $ \rightarrow $ Graphics Support $ \rightarrow $ Intel8xx/9xx/G3x/G4x/HD Graphics and we can check for its presents in the current kernel(of the live medium) with:

                \begin{lstlisting}[style=BashInputRoot]
root# zcat /proc/config.gz | grep CONFIG_DRM_I915
 CONFIG_DRM_I915=m
 # CONFIG_DRM_I915_ALPHA_SUPPORT is not set
 CONFIG_DRM_I915_CAPTURE_ERROR=y
 CONFIG_DRM_I915_COMPRESS_ERROR=y
 CONFIG_DRM_I915_USERPTR=y
 # CONFIG_DRM_I915_GVT is not set
                \end{lstlisting}

                \paragraph{} I will try to include only the stuff which, should be checked, but not include the stuff which is checked by default, so a little mess and that is the problem with kernel configuration... In the future will think of a way to edit this... For now press \textit{h} and have petitions.

                \newpage
                \begin{enumerate}
                    \item \textbf{i915}

                        \paragraph{} \href{https://wiki.gentoo.org/wiki/Intel#Kernel}{Lets not forget our guide}. We already saw that the location for that driver is at \textit{Device Drivers $ \rightarrow $ Graphics Support $ \rightarrow $ Intel8xx/9xx/G3x/G4x/HD Graphics} so we go there and check it

                        \begin{lstlisting}[style=KernelConfig]
 ...
 <*> /dev/agpgart (AGP Support)
     <*> Intel 440LX/BX/GX, I8xx and E7x05 chipset support
 ...
 (2)   Maximum number of GPUs
 ...
 <*> Direct Rendering Manager (XFree86 4.1.0 and higher DRI support)
     [*]   Enable legacy fbdev support for your modesetting driver (NEW)
     (100)   Overallocation of the fbdev buffer (NEW)
 ...
 <*> Intel 8xx/9xx/G3x/G4x/HD Graphics
     [*] Enable capturing GPU state following a hang (NEW)
     [*]    Compress GPU error state (NEW)
     [*] Always enable userptr support (NEW)
 ...
 <*> Backlight & LCD device support
     <*> Generic (aka Sharp Corgi) Backlight Driver (NEW)
 ...
 <*> VGA text console
     [*] Enable Scrollback Buffer in System RAM
     (64)    Scrollback Buffer Size (in KB) (NEW)
     (80) Initial number of console screen columns (NEW)
     (25) Initial number of console screen rows (NEW)
     -*- Framebuffer Console support
     -*-   Map the console to the primary display device
 ...
 <*> Bootup logo
     [*]   Standard 224-color Linux logo (NEW)
 ...
                       \end{lstlisting}

                   \newpage
                   \item \textbf{snd\_hda\_intel}

                       \paragraph{} We will config the kernel for \href{https://wiki.gentoo.org/wiki/ALSA#Kernel}{\textit{alsa}}  and \href{https://wiki.gentoo.org/wiki/PulseAudio#Kernel}{\textit{pulseaudio}} simultaneously. Lets navigate to \textit{Device Drivers $ \rightarrow $ Sound card support $ \rightarrow $ Advanced Linux Sound Architecture}

                       \begin{lstlisting}[style=KernelConfig]
 Device drivers
     sound card support
         advanced linux sound architecture
             [*]     Dynamic device file minor numbers
             (16) Max number of sound cards
 ...
             [*]  PCI sound devices
 ...
                 HD-Audio
                     <*> HD Audio PCI
                     [*] Build hwdep interface for hd audio driver
                     <*> Build HDMI/DisplayPort HD-audio codec support
                     <*> Build Conexant HD-audio codec support
 ...
             Advanced Linux Sound Architecture
                 (2048) Pre-allocated buffer size for HD-audio driver

 # For microphone
     USB sound devices
         <*> USB Audio/MID driver
 ...
 # Should be already checked in
 General setup
     [*] System V IPC
                       \end{lstlisting}

                   \newpage
                   \item \textbf{USB controllers}  \href{https://wiki.gentoo.org/wiki/USB/Guide#Config_options_for_the_kernel}{following this article}

                       \begin{lstlisting}[style=KernelConfig]
 ...
 Device Drivers
     SCSI device support
         ---   SCSI support type (disk, tape, CD-ROM)
         <*>   SCSI disk support
 ...
 Device Drivers
     [*] USB support
         <*> xHCI HCD
         <*> EHCI HCD
         <*> OHCI HCD
         <*> UHCI HCD
         <*> USB printer support
         <*> SUB mass storage support
 ...
 Device Drivers
     HID support
         <*> Generic HID driver
 ...
 Device Drivers
     HID support
         Special HID drivers
             <*> Lenovov/Thinkpad devices  # since I have thikpad e440, all the rest are deselected
 ...
                       \end{lstlisting}

                   \newpage
                   \item \textbf{pcieport} should be already set, and the other stuff I have no idea about :-)

                       \begin{lstlisting}[style=KernelConfig]
 Symbol: PCIEPORTBUS [=y]
 Type: boolean
 Prompt: PCI Express Port Bus support
 Location:
     Bus options
         PCI support:
                       \end{lstlisting}

                   \newpage
                   \item \textbf{lpc\_ich} was not set by default, so lets set it

                       \begin{lstlisting}[style=KernelConfig]
 Device Drivers
     Multifunction devices drivers
         <*> Intel ICH LPC
                       \end{lstlisting}

                   \newpage
                   \item \textbf{ahci} is for the HDD, \href{https://wiki.gentoo.org/wiki/HDD#Kernel}{so lets follow this article} Since I have no idea, I will check all of what they have and leave the research for later.

                       \begin{lstlisting}[style=KernelConfig]
 Device Drivers
     <*> Serial ATA and Parallel ATA drivers
     [*] ATA ACPI Support

 # If the drive is connected to a SATA Port Multiplier:
     [*] SATA Port Multiplier support

 # Select the driver for the SATA controller, e.g.:
     <*> AHCI SATA support (ahci)

 # If the drive is connected to an IDE controller:
     [*] ATA SFF support
     [*] ATA BMDMA support

 # Select the driver for the IDE controller, e.g.:
     <*> Intel ESB, ICH, PIIX3, PIIX4 PATA/SATA support (ata_piix)

 # SCSI device support  --->
     <*> SCSI device support
     <*> SCSI disk support
                       \end{lstlisting}

                   \newpage
                   \item \textbf{i2c\_i801} was enabled by default

                       \begin{lstlisting}[style=KernelConfig]
 Symbol: I2C_I801 [=y]
 Type: tristate
 Prompt: Intel 82801
 Location:
     Devie Drivers
         I2C support
             I2C support (I2C [=y])
                       \end{lstlisting}

                    \newpage
                    \item \textbf{r8169} \href{https://wiki.gentoo.org/wiki/Ethernet#Kernel}{will follow this article}

                        \begin{lstlisting}[style=KernelConfig]
 Device Drivers
     Network device support
         Ethernet driver support
             [*] Realtek devices
                 <*> realtek 8169 PCI gigabit ethernet adapter
                        \end{lstlisting}

                    \newpage
                    \item \textbf{iwlwifi} for the wifi controller and  \href{https://wiki.gentoo.org/wiki/Iwlwifi#Kernel}{follow this article} and \href{https://wiki.gentoo.org/wiki/Wifi#Kernel}{this} also according to make sure to \href{https://wiki.gentoo.org/wiki/Iwlwifi#When_using_built-in_configuration}{built it in like this} (check if /lib64/firmware has the wanted firmware, since it is not at /usr/src/linux/firmware ). In my case it was recommended to use \href{https://wiki.gentoo.org/wiki/Lenovo_ThinkPad_T440s#Required_packages}{iwlwifi-7260-16.ucod}, but according to \href{https://wireless.wiki.kernel.org/en/users/drivers/iwlwifi#firmware}{this table} the \textbf{16} should become \textbf{17}... Why? I don't know; How I got it to work? - I tried
                    \textit{modinfo iwlwifi} and a little luck.

                        \begin{lstlisting}[style=KernelConfig]
 ...
 Networking support
     Wireless
         <*> cfg80211
             [*] enable ppowersave by default
             [*] cfg80211 wireless extensions compatibility
             <*> Generic IEEE 802.11 Networking Stack (mac80211)
             [*] Default rate control algorithm (Minstrel)
             -*-   Enable LED triggers
 ...
 Device Drivers
     Network device support
         Wireless LAN
             [*] Intel devices
                 <*>     Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlwifi)
                 <*>      Intel Wireless WiFi DVM Firmware support
                 <*>      Intel Wireless WiFi MVM Firmware support
    Generic Driver Options
        -*- Userspaces firmware loading support
        [ ] Include in kernel firmware blobs in kernel binary
        (iwlwifi-7260-17.ucode) external firmware blobs to build into kernel binary
        (/lib64/firmware) firmware blobs root directory
                        \end{lstlisting}

                \newpage
                \item pci card reader is ran by rtsx\_pci, more configs later on

                    \begin{lstlisting}[style=KernelConfig]
 Device drivers
     Multifunction device drivers
         <*> Realtek PCI-E card reader
                    \end{lstlisting}
                    
                \newpage
                \item Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller \#1
                
                    \begin{lstlisting}[style=KernelConfig]
 Device drivers
     Misc devices
         <*> Intel Management Engine Interface
         <*> ME Enabled Intel Chipsets
                    \end{lstlisting}

                \end{enumerate}

                \newpage
                \paragraph{} Now lets check if the minimum required options are set \href{https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Activating_required_options}{following this guide}

                \begin{enumerate}

                    \item Enable filesystems
                        \begin{lstlisting}[style=KernelConfig]
 File systems
    <*> second extended fs support
    <*> ext3 fs support
    <*> ext4 fs support
 ...
    DOS/FAT/NT fylesystems
        <*> MSDOS fs support
        <*> VFAT fs support
        [*] Enable utf-8 option by default
        <*> NTFS file system support
            [*]     debugging
            [*]     writing
                        \end{lstlisting}

                    \newpage
                    \item Enable ppp

                        \begin{lstlisting}[style=KernelConfig]
 Device drivers
    Network device support
        <*> PPP support
        <*> PPP for async
        <*> PPP for tty
                         \end{lstlisting}


                     \newpage
                     \item Little twiks on the processor following \href{https://wiki.gentoo.org/wiki/Kernel/Gentoo_Kernel_Configuration_Guide#Multiprocessor.2C_Hyper-Threading_and_multi-core_systems}{this guide} and those \href{https://forums.gentoo.org/viewtopic-t-939150-start-0.html}{notes}

                        \begin{lstlisting}[style=KernelConfig]
 Processor type and features
    [*] Symmetric multi processing support
    [*] SMT (Hyperthreading) scheduler support
    [*] Multi-core scheduler support
    Processor family (Core 2/newer Xeon)
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/Kernel/IKCONFIG_Support}{access the kernel config from /proc/config.gz}

                        \begin{lstlisting}[style=KernelConfig]
 General Setup
     <*> Kernel .config support
         [*] Enable access to .config through /proc/config.gz
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/Udev#Kernel}{udev}

                        \begin{lstlisting}[style=KernelConfig]
 ...
 General setup
     [*] Configure standard kernel features (expert users)
         [ ] Enable deprecated sysfs features to support old userspace tools
         [*] Enable signalfd() system call
 ...
 Enable the block layer
     [*] Block layer SG support v4
 ...
 Networking support
     Networking options
          <*> Unix domain sockets
 ...
 Device Drivers
     Generic Driver Options
         ()  path to uevent helper
         [*] Maintain a devtmpfs filesystem to mount at /dev
     < > ATA/ATAPI/MFM/RLL support (DEPRECATED)
 ...
 File systems
     [*] Inotify support for userspace
     Pseudo filesystems
         [*] /proc file system support
         [*] sysfs file system support
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/ConsoleKit#Kernel}{consolekit}
                        \begin{lstlisting}[style=KernelConfig]
 General setup
     [*] Auditing support
     [*] Enable system-call auditing support
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/Bluetooth#Kernel}{bluetooth}

                        \begin{lstlisting}[style=KernelConfig]
 [*] Networking support
     <*>   Bluetooth subsystem support
         [*]   Bluetooth Classic (BR/EDR) features
         <*>     RFCOMM protocol support
         [ ]       RFCOMM TTY support
         < >     BNEP protocol support
         [ ]       Multicast filter support
         [ ]       Protocol filter support
         <*>     HIDP protocol support
         [*]     Bluetooth High Speed (HS) features
         [*]   Bluetooth Low Energy (LE) features
             Bluetooth device drivers
                 <*> HCI USB driver
                 <*> HCI UART driver
     <*>   RF switch subsystem support
 Device Drivers
     HID support
         <*>   User-space I/O driver support for HID subsystem
                        \end{lstlisting}

                    \newpage
                    \item built in camera
                        \begin{lstlisting}[style=KernelConfig]
 Device drivers
     <*> Multimedia support
         [*] Media USB adapters
             <*> USB Video Class
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/ACPI#Kernel}{acpi}, \href{https://wiki.gentoo.org/wiki/Suspend_and_hibernate}{suspend}, \href{https://wiki.gentoo.org/wiki/ACPI/ThinkPad-special-buttons#Preparation}{thinkpad special buttons}

                        \begin{lstlisting}[style=KernelConfig]
 Power management and ACPI options
     ACPI
         [*] Allow supported ACPI revision to be overriden
         <*> AC adapter
         <*> Battery
         <*> Thermal zone
     [*] Suspend to RAM and standby
     [*] CPU Freq scaling
         Default CPUfreq governor (ondemand)
         -*- 'performance
         <*> 'powersave'
         <*> 'userspace'
         -*- 'ondemand'
         <*> 'conservative' cpufreq governor
         -*- intel p state control
         -*- ACPI processor p-states driver
 Device drivers
     X86 Platform Specific Device Drivers
         <*> Thinkpad ACPI Laptop Extras
             [*] Console audio control ALSA interfface
             [*] Support NVRAM polling for hot keys
                        \end{lstlisting}

                    \newpage
                    \item \href{https://wiki.gentoo.org/wiki/Udisks#Kernel}{udisks} for mounting, partitions and etc

                        \begin{lstlisting}[style=KernelConfig]
 General setup
     [*] Support for paging of anonymous memory (swap)
 Device Drivers
     < > ATA/ATAPI/MFM/RLL support (DEPRECATED)
 File Systems
     Native Language Support
         ... choose whatever you want...
     Pseudo filesystems
         -*- Tmpfs virtual memory file system support (former shm fs)
         [*]   Tmpfs POSIX Access Control Lists

                        \end{lstlisting}

                \end{enumerate}

                \newpage
                \paragraph{} After all the work lets compile.

                \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# make -j4 && make modules_install && make install
                \end{lstlisting}

            \newpage
        \subsection{Bootloader}

                \subsubsection{MBR with BIOS}

                    \paragraph{} With the Linux kernel configured we should make sure that something will boot it - the bootloader. If we have multiple OSs or kernels, to make sure the bootloader will recognize it we need \textit{os-prober}. \href{https://wiki.gentoo.org/wiki/GRUB2}{Notes to follow here}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av sys-boot/grub:2 sys-boot/os-prober
                    \end{lstlisting}

                    \paragraph{}  \href{https://wiki.gentoo.org/wiki/GRUB2#BIOS_with_MBR}{Lest install the bootloader}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# grub-install /dev/sdb
                    \end{lstlisting}

                    \paragraph{} And now lets let grub to make the configuration of the existing kernels and OSs:

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# grub-mkconfig -o /boot/grub/grub.cfg
                    \end{lstlisting}

            \newpage
        \subsection{Final touches}

                \subsubsection{Default editor}

                    \paragraph{} I like \textit{vim}. \href{https://wiki.gentoo.org/wiki/Vim/Guide}{Little guide to vim}
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va vim
 CHroot# eselect editor list
 Available targets for the EDITOR variable:
 [1]   /bin/nano
 [2]   /bin/ed
 [3]   /usr/bin/ex
 [4]   /usr/bin/vi
 [ ]   (free form)
 CHroot# eselect editor set 4
                    \end{lstlisting}

                \newpage
                \subsubsection{Bash autocomplete}
                    \paragraph{} Very nice feature oh the shell  \href{https://wiki.gentoo.org/wiki/Bash#Tab_completion}{is the autocompletion.}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av app-shells/bash-completion
                    \end{lstlisting}

                \newpage
                \subsubsection{Host name}
                    \paragraph{} Host information
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# nano -w /etc/conf.d/hostname
 # Set the hostname variable to the selected host name
 hostname="kaktus"
                    \end{lstlisting}

                    \paragraph{} Domain information, in my case no domain should be configured, so to get rid of "This is hostname.(none)" messages at their login screen. This should then be fixed by editing /etc/issue and deleting the string ."\textbackslash O" from that file.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# nano -w /etc/issue
 # to look like this, without the
 This is \n (\s \m \r) \t
                    \end{lstlisting}

                \newpage
                \subsubsection{Setting root password}

                    \paragraph{} Setting root password

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# passwd
                    \end{lstlisting}

                \newpage
                \subsubsection{Creating user, setting groups, making him be able to sudo}

                    \paragraph{} Lets install \textit{app-admin/sudo},  \href{https://wiki.gentoo.org/wiki/Sudo}{more info here}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va app-admin/sudo
                    \end{lstlisting}

                    \paragraph{} I prefer all users in \textit{wheel} group to execute without password all commands. To achieve this I edit the sudoers file like this:

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# sudoedit /etc/sudoers
                    \end{lstlisting}

                    \lstinputlisting[linerange={76-86}, firstnumber=76, language=LinuxConfigFiles]{sample_configs/sudoers_example}

                    \paragraph{} Adding user with home directory, bash shell and belonging groups:

                    \begin{itemize}
                        \item \textbf{wheel} so to use sudo, for this in a moment
                        \item \textbf{floppy} to use the floppy
                        \item \textbf{audio} to access the audio devices
                        \item \textbf{cdrom} to access the opticaldevices
                        \item \textbf{video} to access the video capturing hardware and doing hardware acceleration
                        \item \textbf{cdrw} to be able to use writing capabilities of optical devices
                        \item \textbf{usb} be able to access USB devices
                        \item \textbf{users} general users group
                        \item \textbf{portage} be able to run portage as normal user
                        \item \textbf{plugdev} be able to use udisks, more later
                        \item \textbf{dimitar} be member of its own group
                    \end{itemize}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# useradd \
     -m \
     -G wheel,floppy,audio,cdrom,video,cdrw,usb,users,plugdev,portage,dimitar \
     -s /bin/bash \
     dimitar
                    \end{lstlisting}

                    \paragraph{} And set password

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# passwd dimitar
                    \end{lstlisting}

                \newpage
                \subsubsection{Logging, cron jobs, rotation tools}

                    \paragraph{} We need a tool to take care of our logging. My choice is \textit{sysklogd}.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av app-admin/sysklogd
 CHroot# rc-update add sysklogd default
                    \end{lstlisting}

                    \paragraph{} But we will need to rotate those logs, so we need \textit{logrotate}. Some help \href{https://wiki.gentoo.org/wiki/Logrotate}{from the Gentoo Wiki} and \href{https://wiki.archlinux.org/index.php/logrotate}{from Arch Wiki} and \href{https://linuxconfig.org/logrotate-8-manual-page}{the manual}.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av logrotate
                    \end{lstlisting}

                    \paragraph{} Now we need to configure the tool. My sample looks like:

                    \lstinputlisting[language=LinuxConfigFiles]{sample_configs/logrotate.conf_example}

                    \paragraph{} Important notes: the files at the end are added by me, since they were missing in the original config and the extra configs at \textit{/etc/logrotate.d}. You can see what the command will do by executing:

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# logrotate -f -d /etc/logrotate.con
                    \end{lstlisting}

                    \paragraph{} \textit{logrotate} should be run at regular intervals, for this we need \textit{cron}. It comes in many forms, but the one I use is \href{https://wiki.gentoo.org/wiki/Cron#fcron}{fcron} since it is designed to work on systems that are not continuously running.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av fcron
 CHroot# rc-update add fcron default
                    \end{lstlisting}

                    \paragraph{} Lets see if we have logrotate as cronjob in any /etc/cron.{hourly,daily,weekly,monthly} directories.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# grep -r logrotate /etc/cron*
 ...
 /etc/cron.daily/logrotate:/usr/bin/logrotate /etc/logrotate.conf
 ...
                    \end{lstlisting}

                    \paragraph{} This means that at \textbf{/etc/cron.daily/}(means it will be started once a day) there is a script named \textbf{logrotate}, which contains the execution of the logrotate command with config file \textbf{/etc/logrotate.conf}. The full script looks like this:

                    \lstinputlisting[language=LinuxConfigFiles]{sample_configs/logrotate_example}

                \newpage
                \subsubsection{Gentoolkit}

                    \paragraph{} Recommend gentoo tools are hidden in \href{https://wiki.gentoo.org/wiki/Gentoolkit}{\textit{gentoolkit}}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va getoolkit
                    \end{lstlisting}

                \newpage
                \subsubsection{ALSA}

                    \paragraph{} We have already configured the \textit{kernel} and \textit{make.conf}. Make sure that \textbf{alsa} use flag is set.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep alsa
 USE="...alsa..."
                    \end{lstlisting}

                    \paragraph{} We also need \href{https://wiki.gentoo.org/wiki/ALSA#Software}{additional software}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va alsa-utils
                    \end{lstlisting}

                    \paragraph{} And make sure the service is going to start

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add alsasound boot
                    \end{lstlisting}

                \newpage
                \subsubsection{Pulseaudio}

                    \paragraph{} We should have already configured the \textit{kernel} and \textit{make.conf}. Lets make sure \textbf{pulseaudio} use flag is set

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep pulseaudio
 USE="...pulseaudio..."
                    \end{lstlisting}

                    \paragraph{} To control the server we can use GUI - either the GTK \textit{pavucontrol} or PulseAudio Preferences \textit{paprefs} or integrated KDE's Phonon. I prefer \textit{pavucontrol}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va pavucontrol alsa-plugins
                    \end{lstlisting}

                    \paragraph{} Make sure your users are included to \textbf{audio} group

                \newpage
                \subsubsection{udev}

                    \paragraph{} \textbf{udev} is the device manager for the linux kernel. The kernel should be already configured. Check for use flag

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep udev
 USE="...udev..."
                    \end{lstlisting}

                    \paragraph{} Make sure to start it.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add udev sysinit
                    \end{lstlisting}

                \newpage
                \subsubsection{consolekit}

                    \paragraph{} \textbf{consolekit} is a framework for defining and tracking users. Make sure the use flag is set, as the kernel configs should be already done.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep consolekit
 USE="...consolekit..."
                    \end{lstlisting}

                    \paragraph{} Make sure the service is going to be started with

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add consolekit default
                    \end{lstlisting}

                \newpage
                \subsubsection{policykit}

                    \paragraph{} \textbf{polkit} is an authorization API indented to be used by privileged programs offering services to unprivileged programs. Lets check fo the use flag

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep policykit
 USE="...policykit..."
                    \end{lstlisting}

                \newpage
                \subsubsection{dbus}

                    \paragraph{} \textbf{dbus} is an interprocess communication system for software application. Lets check the use flag

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep dbus
 USE="...dbus..."
                    \end{lstlisting}

                    \paragraph{} Lets make sure it is started

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add dbus default
                    \end{lstlisting}

                \newpage
                \subsubsection{Networkmanager}

                    \paragraph{} Last but not least - the network manager. We have already configured the kernel. Lets make sure the use flag is set

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep networkmanager
                    \end{lstlisting}

                    \paragraph{} We will need an implementation to use it, I prefer the GTK one

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av nm-applet
                    \end{lstlisting}

                    \paragraph{} Lets make sure it will start an startup

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add NetworkManager default
                    \end{lstlisting}

                    \paragraph{} Make sure your users are included into \textbf{plugdev} group.

                \newpage
                \subsubsection{pci card reader}

                    \paragraph{} Should already have appropriate kernel config. In my case I need also

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va pcsc-tools
                    \end{lstlisting}

                \newpage
                \subsubsection{finger reader}

                    \paragraph{} It may work or not with \textit{fprintd} \href{https://wiki.gentoo.org/wiki/Fingerprint_Reader}{\textit{fprintd}}, but I am leaving it open for now. Last time I tried it did not work.


                \newpage
                \subsubsection{Acpi, laptop\_mode, suspend}

                    \paragraph{} Lets see if \textit{acpi} use flag is set

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep acpi
 USE="...acpi..."
                    \end{lstlisting}

                    \paragraph{} We need the \textit{acpid} package and it should be started at default level, \href{https://wiki.gentoo.org/wiki/ACPI#Emerge}{guide}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av acpid acpitool
 CHroot# rc-update acpid default
                    \end{lstlisting}

                    \paragraph{} Lets install laptop mode, \href{https://wiki.gentoo.org/wiki/Power\_management/Guide#Installation}{guide}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va laptop-mode-tools
 CHroot# rc-update laptop_mode default
                    \end{lstlisting}

                    \paragraph{} For suspending this program should be sufficient, \href{https://wiki.gentoo.org/wiki/Suspend\_and\_hibernate#Software}{guide}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va suspend
                    \end{lstlisting}

                \newpage
                \subsubsection{udiskies}

                    \paragraph{} Hadnling the mounting and etc. make sure to have

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep udisks
 USE="...udisks..."
                    \end{lstlisting}

                    \paragraph{} \href{https://wiki.gentoo.org/wiki/Udisks#Emerge}{Additional software} is found at

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av udiskie
                    \end{lstlisting}

                    \paragraph{} Don't forget to include your users to \textbf{plgudev} group!!!
                
                \newpage
                \subsubsection{OPENntpd}
                    
                    \paragraph{} We want to have automatic syncing of the time!!! Some hints in \href{https://wiki.gentoo.org/wiki/OpenNTPD}{Gentoo wiki} and \href{https://wiki.archlinux.org/index.php/OpenNTPD}{Arch wiki} and \href{https://forums.gentoo.org/viewtopic-p-8003072.html?sid=9f71ccb3c1b6c9b2afb28070af45549c}{this particular forum entry}
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av openntpd
                    \end{lstlisting}
                    
                    \paragraph{} Lets edit the config file by adding some 
                    
                    \lstinputlisting[linerange={23-32}, firstnumber=23, language=LinuxConfigFiles]{sample_configs/ntpd.conf_example}
                    
                    \paragraph{} Lets not forget to add it at default boot level:
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add ntpd default
                    \end{lstlisting}
                    
                    \paragraph{} To check if everything is working:
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# # Lets see if config file is OK
 CHroot# ntpd -n
 configuration OK
 CHroot# # ntpd -s -d To see about offsets and etc
 CHroot# # ntpctl -s status To watch when the clock will be synced, while the previus command is running
                    \end{lstlisting}

                \newpage
                \subsubsection{Display manager}

                    \paragraph{} I prefer to be greeted with something different of an console, thus the need of display manager. My choice is \textit{lightdm}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -va lightdm
                    \end{lstlisting}

                    \paragraph{} To start LightDM we need \textit{dbus} and \textit{xdm} at default level, but presume \textit{dbus} is already there.

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# rc-update add xdm default
                    \end{lstlisting}

                    \paragraph{} We need to set LightDM as the default display manager in \textit{/etc/conf.d/xdm}

                    \lstinputlisting[linerange={8-11}, firstnumber=8,language=LinuxConfigFiles]{sample_configs/xdm_example}

                \newpage
                \subsubsection{Programs}

                    \paragraph{} Here is the list of programs I like to use
                    \begin{itemize}
                        \item xorg - \textbf{xorg-server}
                        \item Desktop environment - \textbf{openbox}
                        \item polkit - \textbf{lxqt-policykit}
                        \item qt based configuration tool for Openbox - \textbf{obconf-qt}
                        \item gtk theme configs with additional plugin for obconf, but not all openbox configs are included - \textbf{lxappearance-obconf}
                        \item additional nice features for config - \textbf{lxqt-config}
                        \item for monitor configuration I prefer - \textbf{arandr}
                        \item menu generator - \textbf{obmenu-generator}
                        \item Clipboard manager - \textbf{parcellite}
                        \item Filemanager - \textbf{spacefm} or \textbf{pcmanfm}, but actually prefer the later
                        \item terminal - \textbf{xterm} for backup and \textbf{qterminal} regularly
                        \item browser - \textbf{firefox}
                        \item mail client - \textbf{thunderbird} or some addon for firefox
                        \item torrent client - \textbf{transmission}
                        \item video/music player - \textbf{smplayer}
                        \item image viewer - \textbf{nomacs}
                        \item document reader - \textbf{qpdfview} and \textbf{okular}, since last time I checked the first did not save the page position on exit
                        \item e-book management for my kindle - \textbf{calibre}
                        \item editor - \textbf{gvim} but in most cases \textbf{mousepad} is enough
                        \item office suits - \textbf{libreoffice}
                        \item ide - \textbf{geany} and \textbf{texstudio}
                        \item I like \LaTeX - \textbf{texlive}, with useflags \textit{extra graphics humanities png science}
                        \item I like python - \textbf{ipython} with useflags \textit{matplotlib examples latex}, also, maybe if needed use \textbf{pip} but \href{https://wiki.gentoo.org/wiki/Pip#Invocation}{BUT ONLY AS USER} OR maybe just \textbf{jupyter}
                        \item network manager - \textbf{nm-applet}, it will pull out NetworkManager
                        \item system monitoring - \textbf{qps}
                        \item quick program starter - \textbf{gmrun} or \textbf{lxqt-runner}, all programs started with gmrun are called gmrun, but I like it better
                        \item program for archives - \textbf{xarchiver}, after its emerge is completed it will suggest additional programs as \textbf{rar}, \textbf{unrar}, \textbf{zip}, \textbf{unzip} and etc.
                        \item system tray - \textbf{stalonetray}
                        \item screensaver - \textbf{xscreensaver}
                        \item git - \textbf{git}
                        \item flash player - \textbf{adobe-flash}
                        \item password manager - \textbf{app-admin/keepass}
                        \item composition manager - \textbf{compton}
                        \item easy app finder - \textbf{xfce4-appfinder}
                    \end{itemize}

                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -uDNva xorg-server openbox obconf-qt lxappearance-obconf lxqt-config arandr obmenu-generator parcellite spacefm xterm qterminal firefox thunderbird transmission smplayer nomacs qpdfview okular calibre gvim mousepad libreoffice texstudio texlive jupyter nm-applet qps gmrun xarchiver stalonetray xscreensaver git app-admin/keepass compton xfce4-appfinder
                    \end{lstlisting}

                    \paragraph{} Here is the software installed in the previous subsubsections
                    \begin{itemize}
                        \item default editor - \textbf{vim}
                        \item bash autocomplete - \textbf{bash-completion}
                        \item sudo - \textbf{sudo}
                        \item logger - \textbf{sysklogd logrotate fcron}
                        \item gentoo tool kit - \textbf{gentoolkit}
                        \item alsa - \textbf{alsa-utils}
                        \item pulseaudio - \textbf{pavucontrol}
                        \item network manager applet - \textbf{nm-applet}
                        \item pci card reader - \textbf{pcsc-tools}
                        \item acpi - \textbf{acpid acpitool laptop-mode-tools suspend}
                        \item udisks - \textbf{udiskie}
                        \item display manager - \textbf{lightdm}
                    \end{itemize}

                    \paragraph{} Last but not least check if services are added to apporpiate levels with \textbf{rc-update | grep {name\_of\_service}}

                    \begin{itemize}
                        \item \textbf{alsasound} should be at \textbf{boot}
                        \item \textbf{NetworkManager} should be at \textbf{default}
                        \item \textbf{acpid} should be at \textbf{default}
                        \item \textbf{consolekit} should be at \textbf{default}
                        \item \textbf{dbus} should be at \textbf{default}
                        \item \textbf{fcron} should be at \textbf{default}
                        \item \textbf{laptop\_mode} should be at \textbf{default}
                        \item \textbf{sysklogd} should be at \textbf{default}
                        \item \textbf{xdm} should be at \textbf{default}
                        \item \textbf{ntpd} should be at \textbf{default}
                        \item \textbf{udev} should be at \textbf{sysinit}
                    \end{itemize}
                
                \newpage
                \subsubsection{LXQT}
                
                    \paragraph{} For the moment, to achieve uniform look of qt and gtk applications I use \href{https://wiki.gentoo.org/wiki/LXQt}{LXQT environment}. \href{https://wiki.archlinux.org/index.php/GTK\%2B#GTK.2B_and_Qt}{Some hints on qt gtk uniform look.} Despite my efforts to search for which variables are needed and etc. I did not manage to achieve qt5 applications to use the gtk themes from lxappearance. Thus for the moment I give up.
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge -av lxqt-base/lxqt-meta
                    \end{lstlisting}
                    
                    \paragraph{} Now lets make sure we will have \textbf{gtk} option in \textit{qtconfig} with including \textbf{gtkstyle} in make.conf. Lets edit the \textbf{GUI} var in \textit{/etc/portage/make.conf} and include only it and check
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# emerge --info | grep gtkstyle
 USE="...gtkstyle..."
                    \end{lstlisting}
                    
                    \paragraph{} For \textbf{qt5} uniform look at the moment we need \textit{qtstyleplugins} which is in an \href{https://wiki.gentoo.org/wiki/Layman}{overlay}. They recommend for newer versions to include use flags \textbf{sync-plugin-portage git}.
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# USE="sync-plugin-portage git" emerge layman
 CHroot# # Check if /etc/layman/layman.cfg has "conf_type : repos.conf"
 CHroot# cat /etc/layman/layman.cfg | grep "conf_type : repos.conf"
 conf_type : repos.conf
 CHroot# mkdir -p /etc/portage/repos.conf
 CHroot# layman-updater -R
                    \end{lstlisting}
                    
                    \paragraph{} Now the desired \textbf{x11-themes/qtstyleplugins} is at \textit{abendbrot}.
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# layman -a abendbrot && layman -S
 CHroot# emerge -va x11-themes/qtstyleplugins
                    \end{lstlisting}
                    
                    \paragraph{} Finaly, since I prefer dark themes sites look awful. A quick way firefox to not respect it is to compile the package without the \textit{gtk} use flag
                    
                    \begin{lstlisting}[style=BashInputCHRoot]
 CHroot# USE="-gtk2" emerge -va firefox
                    \end{lstlisting}
    
    \newpage  
    \section{Specific configs}
        
        \subsection{Openbox}
        
            \paragraph{} Important, work was done on making the uniform look and nice fonts, but for the moment I do not have time to add them. Basically
            \begin{itemize}
                \item Looks like I wont be using LXQT since thanks to \href{https://github.com/manjaro/release-plan/issues/73}{here} and as far as I can remember, qt5ct was not available when I started working, so more info after I make the edits.
                \item Fonts look rather better and uniform. A lot of editing the \textbf{/etc/fonts/local.conf} file and twiching the \textbf{eselect fontconfig}, but basic idea is to make the configs in the previus file(where you can find notes), and disable the stuff below. Now it looks like this:
                
                \begin{lstlisting}[style=BashInputRoot]
 root# eselect fontconfig list 
 Available fontconfig .conf files (* is enabled):
 [1]   09-texlive.conf *
 [2]   10-autohint.conf
 [3]   10-hinting-full.conf
 [4]   10-hinting-medium.conf
 [5]   10-hinting-none.conf
 [6]   10-hinting-slight.conf
 [7]   10-no-sub-pixel.conf
 [8]   10-scale-bitmap-fonts.conf
 [9]   10-sub-pixel-bgr.conf
 [10]  10-sub-pixel-rgb.conf
 [11]  10-sub-pixel-vbgr.conf
 [12]  10-sub-pixel-vrgb.conf
 [13]  10-unhinted.conf
 [14]  11-lcdfilter-default.conf
 [15]  11-lcdfilter-legacy.conf
 [16]  11-lcdfilter-light.conf
 [17]  20-unhint-small-dejavu-sans-mono.conf
 [18]  20-unhint-small-dejavu-sans.conf
 [19]  20-unhint-small-dejavu-serif.conf
 [20]  20-unhint-small-vera.conf
 [21]  25-unhint-nonlatin.conf
 [22]  30-metric-aliases.conf *
 [23]  30-urw-aliases.conf *
 [24]  40-nonlatin.conf *
 [25]  42-luxi-mono.conf
 [26]  45-latin.conf *
 [27]  49-sansserif.conf *
 [28]  50-user.conf
 [29]  51-local.conf *
 [30]  52-infinality.conf
 [31]  57-dejavu-sans-mono.conf *
 [32]  57-dejavu-sans.conf *
 [33]  57-dejavu-serif.conf *
 [34]  59-google-droid-sans-mono.conf *
 [35]  59-google-droid-sans.conf *
 [36]  59-google-droid-serif.conf *
 [37]  60-latin.conf *
 [38]  60-liberation.conf *                                                                  
 [39]  61-stix.conf *                                                                        
 [40]  62-croscore-arimo.conf *                                                              
 [41]  62-croscore-cousine.conf *                                                            
 [42]  62-croscore-symbolneu.conf *                                                          
 [43]  62-croscore-tinos.conf *                                                                   
 [44]  65-fonts-persian.conf *                                                                    
 [45]  65-khmer.conf *                                                                            
 [46]  65-nonlatin.conf *                                                                         
 [47]  69-unifont.conf *                                                                          
 [48]  70-no-bitmaps.conf *                                                                       
 [49]  70-yes-bitmaps.conf                                                                        
 [50]  80-delicious.conf *                                                                        
 [51]  90-synthetic.conf *
 [52]  99pdftoopvp.conf *
                \end{lstlisting}
            \end{itemize}

\end{document}
